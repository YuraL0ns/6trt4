# –ê–Ω–∞–ª–∏–∑ –æ—à–∏–±–æ–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

**–î–∞—Ç–∞:** 2026-01-13  
**–°—Ç–∞—Ç—É—Å:** –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞

---

## üî¥ –û—à–∏–±–∫–∞ 1: 500 –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–æ—Ç–æ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Å–æ–±—ã—Ç–∏—è

### –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã
–ù–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Ñ–æ—Ç–æ –≤ —Å–æ–±—ã—Ç–∏–µ, –µ—Å–ª–∏ –µ–≥–æ –Ω–∞–¥–æ —Å–æ–∑–¥–∞—Ç—å —Å–µ–π—á–∞—Å, –∞ –Ω–µ –¥–µ–ª–∞—Ç—å –µ–≥–æ –æ—Ç–ª–æ–∂–µ–Ω–Ω—ã–º (500 –æ—à–∏–±–∫–∞).

### –ê–Ω–∞–ª–∏–∑ –∫–æ–¥–∞

**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `laravel/app/Http/Controllers/Photo/EventController.php`

**–ü—Ä–æ–±–ª–µ–º–∞:**
1. –ú–µ—Ç–æ–¥ `store()` (—Å—Ç—Ä–æ–∫–∏ 66-230) —Å–æ–∑–¥–∞–µ—Ç —Å–æ–±—ã—Ç–∏–µ, –Ω–æ **–ù–ï –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–≥—Ä—É–∑–∫—É —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π**
2. –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –æ—Ç–¥–µ–ª—å–Ω–æ —á–µ—Ä–µ–∑ –º–µ—Ç–æ–¥ `uploadPhotos()` (—Å—Ç—Ä–æ–∫–∏ 425-575)
3. –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—ã—Ç–∞–µ—Ç—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ —Å—Ä–∞–∑—É –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Å–æ–±—ã—Ç–∏—è —á–µ—Ä–µ–∑ —Ñ–æ—Ä–º—É, —ç—Ç–æ –º–æ–∂–µ—Ç –≤—ã–∑–≤–∞—Ç—å 500 –æ—à–∏–±–∫—É

**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**
- –§–æ—Ä–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Å–æ–±—ã—Ç–∏—è –º–æ–∂–µ—Ç –ø—ã—Ç–∞—Ç—å—Å—è –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ –≤–º–µ—Å—Ç–µ —Å –¥–∞–Ω–Ω—ã–º–∏ —Å–æ–±—ã—Ç–∏—è
- –ù–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ñ–æ—Ç–æ –≤ –º–µ—Ç–æ–¥–µ `store()`
- –û—à–∏–±–∫–∞ –º–æ–∂–µ—Ç –≤–æ–∑–Ω–∏–∫–∞—Ç—å –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ –¥–æ —Ç–æ–≥–æ, –∫–∞–∫ —Å–æ–±—ã—Ç–∏–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–∑–¥–∞–Ω–æ
- –ü—Ä–æ–±–ª–µ–º—ã —Å –ø—Ä–∞–≤–∞–º–∏ –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è–º –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Å–æ–±—ã—Ç–∏—è

**–ö–æ–¥ —Å–æ–∑–¥–∞–Ω–∏—è —Å–æ–±—ã—Ç–∏—è:**
```php
// EventController::store() - —Å–æ–∑–¥–∞–µ—Ç —Å–æ–±—ã—Ç–∏–µ, –Ω–æ –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ñ–æ—Ç–æ
$event = Event::create([...]);
// –°–æ–∑–¥–∞—é—Ç—Å—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
// –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–±–ª–æ–∂–∫–∞
// –ù–ï–¢ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π!
```

**–ö–æ–¥ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ (–æ—Ç–¥–µ–ª—å–Ω—ã–π –º–µ—Ç–æ–¥):**
```php
// EventController::uploadPhotos() - –æ—Ç–¥–µ–ª—å–Ω—ã–π –º–µ—Ç–æ–¥ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ
// –¢—Ä–µ–±—É–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ —Å–æ–±—ã—Ç–∏–µ
```

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é

1. **–î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É —Ñ–æ—Ç–æ –≤ –º–µ—Ç–æ–¥ `store()`:**
   ```php
   // –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è —Å–æ–±—ã—Ç–∏—è –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ–±–ª–æ–∂–∫–∏
   if ($request->hasFile('photos')) {
       $files = $request->file('photos');
       $result = $this->uploadService->uploadPhotos($event, $files);
       // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
   }
   ```

2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–æ—Ä–º—É —Å–æ–∑–¥–∞–Ω–∏—è —Å–æ–±—ã—Ç–∏—è:**
   - –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Ñ–æ—Ä–º–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ñ–æ—Ç–æ
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `enctype="multipart/form-data"` –≤ —Ñ–æ—Ä–º–µ

3. **–î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫:**
   - –û–±–µ—Ä–Ω—É—Ç—å –∑–∞–≥—Ä—É–∑–∫—É —Ñ–æ—Ç–æ –≤ try-catch
   - –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –æ—à–∏–±–∫–∏ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

4. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞:**
   - –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –ø—Ä–∞–≤–∞–º–∏
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞ –Ω–∞ –∑–∞–ø–∏—Å—å –≤ `storage/app/public/events/`

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –í–´–°–û–ö–ò–ô

---

## üî¥ –û—à–∏–±–∫–∞ 2: –ê–Ω–∞–ª–∏–∑ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è, —Å–∞–π—Ç –º–µ–¥–ª–µ–Ω–Ω–æ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è

### –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã
–ê–Ω–∞–ª–∏–∑ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è, –µ—Å–ª–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ. –°–∞–π—Ç –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—ã, –ª–∏–±–æ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç, –Ω–æ –æ—á–µ–Ω—å –¥–æ–ª–≥–æ.

### –ê–Ω–∞–ª–∏–∑ –∫–æ–¥–∞

**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** 
- `docker-compose.production.yml:206` - –∫–æ–º–∞–Ω–¥–∞ Celery: `-P solo`
- `fastapi/tasks/celery_app.py:182` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è: `worker_pool='solo'`

**–ü—Ä–æ–±–ª–µ–º–∞:**
1. **Solo Pool –±–ª–æ–∫–∏—Ä—É–µ—Ç –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã:**
   - Solo pool = –æ–¥–∏–Ω –ø—Ä–æ—Ü–µ—Å—Å, –æ–¥–∏–Ω –ø–æ—Ç–æ–∫
   - –í—Å–µ –∑–∞–¥–∞—á–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ
   - –í–æ –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ–¥–Ω–æ–π —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ (35 —Å–µ–∫—É–Ω–¥) –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è

2. **–°–≤—è–∑—å —Å –ø—Ä–µ–¥—ã–¥—É—â–µ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–æ–π:**
   - –≠—Ç–æ —Ç–∞ –∂–µ –ø—Ä–æ–±–ª–µ–º–∞, —á—Ç–æ –±—ã–ª–∞ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –≤ `DIAGNOSTIC_REPORT.md`
   - Solo pool –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –∑–∞–º–µ–¥–ª—è–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫—É

3. **–í–ª–∏—è–Ω–∏–µ –Ω–∞ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å:**
   - –ï—Å–ª–∏ Celery worker –∑–∞–Ω—è—Ç –æ–±—Ä–∞–±–æ—Ç–∫–æ–π —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π, –æ–Ω –Ω–µ –º–æ–∂–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –¥—Ä—É–≥–∏–µ –∑–∞–¥–∞—á–∏
   - –ó–∞–ø—Ä–æ—Å—ã –∫ FastAPI –º–æ–≥—É—Ç –∑–∞–≤–∏—Å–∞—Ç—å, –µ—Å–ª–∏ –æ–Ω–∏ —Ç—Ä–µ–±—É—é—Ç Celery –∑–∞–¥–∞—á
   - Laravel –º–æ–∂–µ—Ç –∂–¥–∞—Ç—å –æ—Ç–≤–µ—Ç–∞ –æ—Ç FastAPI, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ —Ç–∞–π–º–∞—É—Ç–∞–º

**–ö–æ–¥ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:**
```python
# fastapi/tasks/celery_app.py:182
worker_pool='solo',  # –í–ê–ñ–ù–û: solo –≤–º–µ—Å—Ç–æ prefork –¥–ª—è ML –±–∏–±–ª–∏–æ—Ç–µ–∫
```

```yaml
# docker-compose.production.yml:206
command: celery -A tasks.celery_app worker --loglevel=info -P solo --queues=...
```

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é

1. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Threads Pool (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø):**
   ```yaml
   # docker-compose.production.yml
   command: celery -A tasks.celery_app worker --loglevel=info -P threads --concurrency=8 --queues=celery,high_priority,default,low_priority
   ```
   
   ```python
   # fastapi/tasks/celery_app.py
   worker_pool='threads',  # –ò—Å–ø–æ–ª—å–∑—É–µ–º threads –≤–º–µ—Å—Ç–æ solo –¥–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º–∞
   ```

2. **–†–∞–∑–¥–µ–ª–∏—Ç—å –≤–æ—Ä–∫–µ—Ä—ã:**
   - –û–¥–∏–Ω –≤–æ—Ä–∫–µ—Ä –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π (solo pool)
   - –î—Ä—É–≥–æ–π –≤–æ—Ä–∫–µ—Ä –¥–ª—è –ø–æ–∏—Å–∫–∞/—Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è (threads pool)

3. **–î–æ–±–∞–≤–∏—Ç—å —Ç–∞–π–º–∞—É—Ç—ã:**
   - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–∞–π–º–∞—É—Ç—ã –¥–ª—è HTTP –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ FastAPI
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –≥–¥–µ –≤–æ–∑–º–æ–∂–Ω–æ

4. **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã:**
   - –ö–µ—à–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ—á–µ—Ä–µ–¥–∏ —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º–∏

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô

**–°–≤—è–∑–∞–Ω–æ —Å:** `DIAGNOSTIC_REPORT.md` - —Ç–∞ –∂–µ –ø—Ä–æ–±–ª–µ–º–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

---

## üî¥ –û—à–∏–±–∫–∞ 3: –ü–æ–∏—Å–∫ –ø–æ —Ñ–æ—Ç–æ –≤—Ä–µ–º—è –æ—Ç –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–¥–∞–µ—Ç –æ—à–∏–±–∫—É

### –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã
–ü–æ–∏—Å–∫ –ø–æ —Ñ–æ—Ç–æ –≤—Ä–µ–º—è –æ—Ç –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–¥–∞–µ—Ç –æ—à–∏–±–∫—É (–ø—Ä–∏ —ç—Ç–æ–º –æ—à–∏–±–∫—É –Ω–µ–ª—å–∑—è –Ω–∞–π—Ç–∏ –Ω–∏–≥–¥–µ).

### –ê–Ω–∞–ª–∏–∑ –∫–æ–¥–∞

**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:**
- `fastapi/tasks/face_search.py` - –ø–æ–∏—Å–∫ –ø–æ –ª–∏—Ü–∞–º
- `fastapi/tasks/number_search.py` - –ø–æ–∏—Å–∫ –ø–æ –Ω–æ–º–µ—Ä–∞–º
- `laravel/app/Http/Controllers/EventController.php` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–∏—Å–∫–∞

**–ü—Ä–æ–±–ª–µ–º–∞:**
1. **–û—à–∏–±–∫–∏ –Ω–µ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –¥–æ–ª–∂–Ω—ã–º –æ–±—Ä–∞–∑–æ–º:**
   - –í `face_search.py:253-261` –æ—à–∏–±–∫–∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ, –Ω–æ –º–æ–≥—É—Ç –Ω–µ –ø–æ–ø–∞–¥–∞—Ç—å –≤ –ª–æ–≥–∏ Laravel
   - –í `number_search.py:165-176` –∞–Ω–∞–ª–æ–≥–∏—á–Ω–∞—è —Å–∏—Ç—É–∞—Ü–∏—è

2. **–û—à–∏–±–∫–∏ –º–æ–≥—É—Ç –±—ã—Ç—å —Å–∫—Ä—ã—Ç—ã:**
   ```python
   # fastapi/tasks/face_search.py:253
   except Exception as e:
       error_msg = f"CRITICAL ERROR in search_similar_faces: {str(e)}"
       logger.error(error_msg, exc_info=True)
       # –í–æ–∑–≤—Ä–∞—â–∞–µ–º –æ—à–∏–±–∫—É –≤–º–µ—Å—Ç–æ raise
       return {"status": "error", "error": error_msg, "results": []}
   ```
   - –û—à–∏–±–∫–∞ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è –≤ Celery, –Ω–æ –º–æ–∂–µ—Ç –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –≤ Laravel

3. **–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã –æ—à–∏–±–æ–∫:**
   - –¢–∞–π–º–∞—É—Ç—ã –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –±–æ–ª—å—à–∏—Ö —Å–æ–±—ã—Ç–∏–π
   - –ü—Ä–æ–±–ª–µ–º—ã —Å –∑–∞–≥—Ä—É–∑–∫–æ–π –º–æ–¥–µ–ª–µ–π InsightFace
   - –û—à–∏–±–∫–∏ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ —Ñ–∞–π–ª–æ–≤
   - –ü—Ä–æ–±–ª–µ–º—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö

**–ö–æ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–æ–∏—Å–∫–∞:**
```php
// laravel/app/Http/Controllers/EventController.php:266-277
if ($request->type === 'face') {
    $result = $this->processingService->searchSimilarFaces(...);
} else {
    $result = $this->processingService->searchByNumber(...);
}
// –û—à–∏–±–∫–∏ –º–æ–≥—É—Ç –±—ã—Ç—å —Å–∫—Ä—ã—Ç—ã –≤ $result['status'] === 'error'
```

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é

1. **–£–ª—É—á—à–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:**
   ```php
   // –í EventController –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫
   if (isset($result['status']) && $result['status'] === 'error') {
       \Log::error("Search error", [
           'type' => $request->type,
           'error' => $result['error'] ?? 'Unknown error',
           'event_id' => $event->id
       ]);
   }
   ```

2. **–î–æ–±–∞–≤–∏—Ç—å —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫:**
   - –°–æ–∑–¥–∞—Ç—å middleware –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –≤—Å–µ—Ö –æ—à–∏–±–æ–∫ –ø–æ–∏—Å–∫–∞
   - –°–æ—Ö—Ä–∞–Ω—è—Ç—å –æ—à–∏–±–∫–∏ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞

3. **–£–ª—É—á—à–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ –≤ FastAPI:**
   ```python
   # –î–æ–±–∞–≤–∏—Ç—å –±–æ–ª–µ–µ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
   try:
       # –∫–æ–¥ –ø–æ–∏—Å–∫–∞
   except TimeoutError as e:
       logger.error(f"Search timeout: {e}", exc_info=True)
       # –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ Laravel —á–µ—Ä–µ–∑ webhook –∏–ª–∏ –æ—á–µ—Ä–µ–¥—å
   except Exception as e:
       logger.error(f"Search error: {e}", exc_info=True)
       # –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ Laravel
   ```

4. **–î–æ–±–∞–≤–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:**
   - –°–æ–∑–¥–∞—Ç—å endpoint –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–∏—Å–∫–∞
   - –î–æ–±–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö

5. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏:**
   ```bash
   # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ Celery
   docker logs hunter-photo-celery | grep -i error
   
   # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ FastAPI
   docker logs hunter-photo-fastapi | grep -i error
   
   # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ Laravel
   tail -f laravel/storage/logs/laravel.log | grep -i search
   ```

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –°–†–ï–î–ù–ò–ô

---

## üî¥ –û—à–∏–±–∫–∞ 4: –¶–µ–Ω–∞ –≤—ã—Å—Ç–∞–≤–∏–ª–∞—Å—å 144 —Ä—É–±–ª—è –≤–º–µ—Å—Ç–æ 120 —Ä—É–±–ª–µ–π

### –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã
–ü–æ—á–µ–º—É-—Ç–æ —Ü–µ–Ω–∞ –≤—ã—Å—Ç–∞–≤–∏–ª–∞—Å—å 144 —Ä—É–±–ª—è, —Ö–æ—Ç—è –¥–æ–ª–∂–Ω–∞ –±—ã–ª–∞ –≤—ã—Å—Ç–∞–≤–∏—Ç—å—Å—è 120 —Ä—É–±–ª–µ–π. –ì–¥–µ-—Ç–æ –ø—Ä–æ–±–ª–µ–º–∞ —Å –≤—ã—Å—Ç–∞–≤–ª–µ–Ω–∏–µ–º —Ü–µ–Ω—ã.

### –ê–Ω–∞–ª–∏–∑ –∫–æ–¥–∞

**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:**
- `laravel/app/Models/Photo.php:115-128` - –º–µ—Ç–æ–¥ `getPriceWithCommission()`
- `laravel/app/Http/Controllers/Photo/EventController.php:1066-1068` - —Ä–∞—Å—á–µ—Ç —Ü–µ–Ω—ã –≤ `createEventInfoJson()`
- `laravel/app/Http/Controllers/Photo/EventController.php:1104-1105` - —Ä–∞—Å—á–µ—Ç —Ü–µ–Ω—ã —Ñ–æ—Ç–æ

**–§–æ—Ä–º—É–ª–∞ —Ä–∞—Å—á–µ—Ç–∞ —Ü–µ–Ω—ã:**
```php
// laravel/app/Models/Photo.php:128
return $basePrice * (1 + ($commissionPercent / 100));

// laravel/app/Http/Controllers/Photo/EventController.php:1068
$priceWithCommission = $event->price * (1 + ($commissionPercent / 100));
```

**–ê–Ω–∞–ª–∏–∑:**
- –ï—Å–ª–∏ –±–∞–∑–æ–≤–∞—è —Ü–µ–Ω–∞ = 100‚ÇΩ, –∫–æ–º–∏—Å—Å–∏—è = 20%:
  - –ü—Ä–∞–≤–∏–ª—å–Ω–æ: 100 * (1 + 20/100) = 100 * 1.2 = **120‚ÇΩ** ‚úÖ
  
- –ï—Å–ª–∏ –ø–æ–ª—É—á–∏–ª–æ—Å—å 144‚ÇΩ:
  - –í–∞—Ä–∏–∞–Ω—Ç 1: –ë–∞–∑–æ–≤–∞—è —Ü–µ–Ω–∞ = 120‚ÇΩ, –∫–æ–º–∏—Å—Å–∏—è = 20%:
    - 120 * 1.2 = **144‚ÇΩ** ‚úÖ (–ø—Ä–∞–≤–∏–ª—å–Ω–æ, –µ—Å–ª–∏ –±–∞–∑–æ–≤–∞—è —Ü–µ–Ω–∞ –±—ã–ª–∞ 120)
  
  - –í–∞—Ä–∏–∞–Ω—Ç 2: –ë–∞–∑–æ–≤–∞—è —Ü–µ–Ω–∞ = 100‚ÇΩ, –∫–æ–º–∏—Å—Å–∏—è = 44%:
    - 100 * 1.44 = **144‚ÇΩ** ‚ùå (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ)
  
  - –í–∞—Ä–∏–∞–Ω—Ç 3: –î–≤–æ–π–Ω–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∫–æ–º–∏—Å—Å–∏–∏:
    - 100 * 1.2 * 1.2 = **144‚ÇΩ** ‚ùå (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ)

**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**

1. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –±–∞–∑–æ–≤–∞—è —Ü–µ–Ω–∞:**
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É—Å—Ç–∞–Ω–æ–≤–∏–ª —Ü–µ–Ω—É 120‚ÇΩ –≤–º–µ—Å—Ç–æ 100‚ÇΩ
   - –¶–µ–Ω–∞ —Å–æ–±—ã—Ç–∏—è –±—ã–ª–∞ –∏–∑–º–µ–Ω–µ–Ω–∞ –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è

2. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–æ–º–∏—Å—Å–∏—è:**
   - –ö–æ–º–∏—Å—Å–∏—è —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –∫–∞–∫ 44% –≤–º–µ—Å—Ç–æ 20%
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: `\App\Models\Setting::get('percent_for_sales', 20)`

3. **–î–≤–æ–π–Ω–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∫–æ–º–∏—Å—Å–∏–∏:**
   - –ö–æ–º–∏—Å—Å–∏—è –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –¥–≤–∞–∂–¥—ã –≤ —Ä–∞–∑–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö
   - –¶–µ–Ω–∞ —É–∂–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–æ–º–∏—Å—Å–∏—é, –Ω–æ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –µ—â–µ —Ä–∞–∑

4. **–ü—Ä–æ–±–ª–µ–º–∞ —Å –æ–∫—Ä—É–≥–ª–µ–Ω–∏–µ–º:**
   - –û–∫—Ä—É–≥–ª–µ–Ω–∏–µ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –Ω–µ—Ç–æ—á–Ω–æ—Å—Ç—è–º
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `round()` –∏–ª–∏ `number_format()`

**–ö–æ–¥ —Ä–∞—Å—á–µ—Ç–∞:**
```php
// laravel/app/Http/Controllers/Photo/EventController.php:1104-1105
$photoPriceWithCommission = ($photo->price ?: $event->price) * (1 + ($commissionPercent / 100));
```

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é

1. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–æ–º–∏—Å—Å–∏–∏:**
   ```php
   // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
   SELECT * FROM settings WHERE key = 'percent_for_sales';
   
   // –ò–ª–∏ —á–µ—Ä–µ–∑ –∫–æ–¥
   $commission = \App\Models\Setting::get('percent_for_sales', 20);
   \Log::info("Current commission: {$commission}%");
   ```

2. **–î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞—Å—á–µ—Ç–∞ —Ü–µ–Ω—ã:**
   ```php
   \Log::info("Price calculation", [
       'base_price' => $event->price,
       'commission_percent' => $commissionPercent,
       'price_with_commission' => $priceWithCommission,
       'calculation' => "{$event->price} * (1 + ({$commissionPercent} / 100)) = {$priceWithCommission}"
   ]);
   ```

3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –Ω–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –ª–∏ –∫–æ–º–∏—Å—Å–∏—è –¥–≤–∞–∂–¥—ã:**
   - –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Ü–µ–Ω–∞ —Å–æ–±—ã—Ç–∏—è –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–æ–º–∏—Å—Å–∏—é
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ –º–µ—Å—Ç–∞, –≥–¥–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫–æ–º–∏—Å—Å–∏—è

4. **–î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é:**
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –∫–æ–º–∏—Å—Å–∏—è –≤ –¥–æ–ø—É—Å—Ç–∏–º—ã—Ö –ø—Ä–µ–¥–µ–ª–∞—Ö (0-100%)
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –±–∞–∑–æ–≤–∞—è —Ü–µ–Ω–∞ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–∞—è

5. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å —Ñ–æ—Ä–º—É–ª—É (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ):**
   ```php
   // –ï—Å–ª–∏ –∫–æ–º–∏—Å—Å–∏—è –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å 20%, –Ω–æ –ø–æ–ª—É—á–∞–µ—Ç—Å—è 44%
   // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ª–∏ —Ñ–æ—Ä–º—É–ª–∞: basePrice * (commissionPercent / 100) + basePrice
   // –í–º–µ—Å—Ç–æ: basePrice * (1 + (commissionPercent / 100))
   ```

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –°–†–ï–î–ù–ò–ô

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–æ–º–∏—Å—Å–∏–∏ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
docker exec hunter-photo-postgres psql -U hunter_photo -d hunter_photo -c "SELECT * FROM settings WHERE key = 'percent_for_sales';"
```

---

## üìä –°–≤–æ–¥–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –ø—Ä–æ–±–ª–µ–º

| ‚Ññ | –ü—Ä–æ–±–ª–µ–º–∞ | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç | –°—Ç–∞—Ç—É—Å | –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã |
|---|----------|-----------|--------|-----------------|
| 1 | 500 –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–æ—Ç–æ | –í–´–°–û–ö–ò–ô | –¢—Ä–µ–±—É–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è | `EventController.php:store()` |
| 2 | –ê–Ω–∞–ª–∏–∑ –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è/—Å–∞–π—Ç –º–µ–¥–ª–µ–Ω–Ω–æ | –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô | –°–≤—è–∑–∞–Ω–æ —Å solo pool | `celery_app.py`, `docker-compose.production.yml` |
| 3 | –ü–æ–∏—Å–∫ –ø–æ —Ñ–æ—Ç–æ –≤—ã–¥–∞–µ—Ç –æ—à–∏–±–∫—É | –°–†–ï–î–ù–ò–ô | –¢—Ä–µ–±—É–µ—Ç —É–ª—É—á—à–µ–Ω–∏—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è | `face_search.py`, `number_search.py` |
| 4 | –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è —Ü–µ–Ω–∞ (144 –≤–º–µ—Å—Ç–æ 120) | –°–†–ï–î–ù–ò–ô | –¢—Ä–µ–±—É–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫ | `Photo.php`, `EventController.php` |

---

## üîß –ü–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π

### –ù–µ–º–µ–¥–ª–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è (–∫—Ä–∏—Ç–∏—á–Ω–æ):
1. ‚úÖ –ò—Å–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—É —Å solo pool (–û—à–∏–±–∫–∞ 2)
2. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É —Ñ–æ—Ç–æ –≤ –º–µ—Ç–æ–¥ `store()` (–û—à–∏–±–∫–∞ 1)

### –ö—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è (1-2 –¥–Ω—è):
3. –£–ª—É—á—à–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ –ø–æ–∏—Å–∫–∞ (–û—à–∏–±–∫–∞ 3)
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏ –∏—Å–ø—Ä–∞–≤–∏—Ç—å —Ä–∞—Å—á–µ—Ç —Ü–µ–Ω—ã (–û—à–∏–±–∫–∞ 4)

### –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è (–Ω–µ–¥–µ–ª—è):
5. –î–æ–±–∞–≤–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—à–∏–±–æ–∫
6. –°–æ–∑–¥–∞—Ç—å —Å–∏—Å—Ç–µ–º—É —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ–± –æ—à–∏–±–∫–∞—Ö
7. –î–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π

---

## üìù –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:**
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–¥–∏–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –ª–æ–≥–æ–≤
   - –°–æ—Ö—Ä–∞–Ω—è—Ç—å –æ—à–∏–±–∫–∏ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞

2. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:**
   - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–ª–µ—Ä—Ç—ã –Ω–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏
   - –û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

3. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
   - –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ —Ü–µ–Ω—ã
   - –¢–µ—Å—Ç—ã –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ
   - –¢–µ—Å—Ç—ã –¥–ª—è –ø–æ–∏—Å–∫–∞

4. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:**
   - –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å —Ä–∞—Å—á–µ—Ç–∞ —Ü–µ–Ω—ã
   - –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ
