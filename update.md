# –ò–∑–º–µ–Ω–µ–Ω–∏—è
1. –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–µ—Ä–µ—Å–º–æ—Ç—Ä–µ—Ç—å —Ñ—É–Ω–∫—Ü–∏—é –ø–æ–∏—Å–∫–∞ –ª–∏—Ü, —á—Ç–æ–±—ã –æ–Ω–∞ –≤–µ—Ä–Ω–æ –æ–ø—Ä–µ–¥–µ–ª—è–ª–∞ –ª–∏—Ü–∞, –∏ –≤ –¥–∞–ª—å–Ω–µ–π—à–µ–º –º—ã –º–æ–≥–ª–∏ –≤—ã–≤–µ—Å—Ç–∏ —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ.
2. –§—É–Ω–∫—Ü–∏—è remove_exif –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–æ—Ä–∞–±–æ—Ç–∞—Ç—å –∏ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å –≤ remove_to_exif_and_rotate —Ç–∞–∫ —á—Ç–æ–±—ã –æ–Ω–∞ –µ—â–µ –∏ –ø–æ–≤–æ—Ä–∞—á–∏–≤–∞–ª–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–∞ 90 –≥—Ä–∞–¥—É—Å–æ–≤ –ø–æ—Ç–æ–º—É —á—Ç–æ —Å–µ–π—á–∞—Å –µ—Å–ª–∏ —É –º–µ–Ω—è —Ñ–æ—Ç–æ —Å–¥–µ–ª–∞–Ω–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ, —Ç–æ –Ω–∞ –∫–æ–º–ø—å—é—Ç–µ—Ä–µ —è —Å–º–æ—Ç—Ä—é –µ–≥–æ - —Ç–∞–º –≤—Å—ë –æ–∫–µ–π, –∞ –≤–æ—Ç –Ω–∞ —Å–∞–π—Ç–µ –æ–Ω–æ –ø–µ—Ä–µ–≤–µ—Ä–Ω—É—Ç–æ –±–æ–∫–æ–º.
3. –ü–æ–∏—Å–∫ –Ω–æ–º–µ—Ä–æ–≤ –Ω–µ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –Ω–æ–º–µ—Ä–∞ –Ω–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è—Ö, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–µ—Ä–µ—Å–º–æ—Ç—Ä–µ—Ç—å –∫–æ–¥ –ø–æ–∏—Å–∫–∞ –Ω–æ–º–µ—Ä–æ–≤, –ø–æ—Ç–æ–º—É —á—Ç–æ –Ω–æ–º–µ—Ä–∞ –µ—Å—Ç—å - –Ω–æ –≤ –ø—Ä–æ–µ–∫—Ç–µ –æ–Ω–∏ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è, —Ö–æ—Ç—è –Ω–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –ø—Ä–æ—Å—Ç–æ–º —á–µ—Ä–µ–∑ pyCharm EasyOCR –æ–ø–µ—Ä–µ–¥–µ–ª—è–µ—Ç –Ω–æ–º–µ—Ä–∞ –∏ InsightFace –∏—â–µ—Ç –ª–∏—Ü–∞.
4. –£–±—Ä–∞—Ç—å –∏–∑ –≤—ã–±–æ—Ä–∞ –∫–∞–∫–∏–µ –∞–Ω–∞–ª–∏–∑—ã –ø—Ä–æ–≤–æ–¥–∏—Ç—å –ø—É–Ω–∫—Ç —Å TimeLine —Ç–∞–∫ –∫–∞–∫ –µ–≥–æ —Å–µ–π—á–∞—Å –Ω–µ—Ç—É –≤ –ø—Ä–æ–µ–∫—Ç–µ.
5. –ü–µ—Ä–µ–ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–µ—Å—å –∫–æ–¥ –∫–æ—Ç–æ—Ä—ã–π —Ä–∞–±–æ—Ç–∞–µ—Ç —Å Celery, —Ç–∞–∫ –∫–∞–∫ —Å–µ–π—á–∞—Å –æ–Ω –Ω–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ. 
6. –î–æ–±–∞–≤–∏—Ç—å —Å—Å—ã–ª–∫—É –Ω–∞ admin/photos —Ç–∞–º —É –º–µ–Ω—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞–∞ –∫—É–¥–∞ –≤—ã–≤–µ–¥–µ–Ω—ã –≤—Å–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –ø—Ä–æ–µ–∫—Ç–µ –∏ –≤ —Å–æ–±—ã—Ç–∏–∏, –∞ —Ç–∞–∫ –∂–µ json –¥–∞–Ω–Ω—ã–µ.


# –û–±–Ω–æ–≤–∏–ª 
1. –ü–æ—Å–ª–µ –ø–æ–∫—É–ø–∫–∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ —É –Ω–∞—Å –ø–æ—á–µ–º—É —Ç–æ –≤—ã–ø–æ–ª–∑–∞–µ—Ç custom_iamge, –Ω–∞–º –Ω–∞–¥–æ —ç—Ç–æ —É–±—Ä–∞—Ç—å –∏ –ø–æ—Å–ª–µ —Ç–æ–≥–æ –∫–∞–∫ –ø–æ–∫—É–ø–∫–∞ —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–∏–ª–∞—Å—å –º—ã –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É —Å–∫–∞—á–∞—Ç—å –∞—Ä—Ö–∏–≤ —Å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–µ–π, –∏ –ø–æ–ª—É—á–∞–µ—Ç—Å—è –º—ã –±–µ—Ä–µ–º origina l—ç—Ç–æ–π —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –∏ –∞—Ä—Ö–∏–≤–∏—Ä—É–µ–º, –∏ –¥–∞–µ–º —Å—Å—ã–ª–∫—É –Ω–∞ –∞—Ä—Ö–∏–≤
2. –ü–æ—Å–ª–µ –∞–Ω–∞–ª–∏–∑–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–π–∏ —Å—Ç–∞—Ç—É—Å —É —Å–æ–±—ã—Ç–∏—è –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è —Å "–í –æ–±—Ä–∞–±–æ—Ç–∫–µ" –Ω–∞ "–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω–æ"

# –î–æ–ø–æ–ª–Ω–µ–Ω–∏—è –∫ –∫–æ–¥—É - –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –û–ë–ù–û–í–õ–ï–ù–ò–ï
```
–¢—É—Ç —Ç–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ —Å–∫–∞–∑–∞—Ç—å —Ç–æ—á–Ω–æ: —É —Ç–µ–±—è –Ω–µ ‚Äú—á—É—Ç—å –∫—Ä–∏–≤–æ‚Äù ‚Äî —É —Ç–µ–±—è –¥–≤–æ–π–Ω–æ–π –∏ –º–µ—Å—Ç–∞–º–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ–≤–æ—Ä–æ—Ç EXIF. –û–±—ä—è—Å–Ω—è—é –ø–æ —à–∞–≥–∞–º, —á—Ç–æ –∏–º–µ–Ω–Ω–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∏ –∫–∞–∫ —ç—Ç–æ —á–∏–Ω–∏—Ç—Å—è —Ä–∞–∑ –∏ –Ω–∞–≤—Å–µ–≥–¥–∞.

üî• –ß—Ç–æ –º—ã –≤–∏–¥–∏–º –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–∏

–û–¥–Ω–∞ –∏ —Ç–∞ –∂–µ —Å—Ü–µ–Ω–∞

–û–¥–Ω–∏ –∏ —Ç–µ –∂–µ –ª—é–¥–∏

–ß–∞—Å—Ç—å –∫–∞–¥—Ä–æ–≤ –ø–µ—Ä–µ–≤—ë—Ä–Ω—É—Ç–∞ –≤–≤–µ—Ä—Ö –Ω–æ–≥–∞–º–∏

–ß–∞—Å—Ç—å ‚Äî –ø–æ–≤–µ—Ä–Ω—É—Ç–∞ –Ω–∞ 90¬∞

–ß–∞—Å—Ç—å ‚Äî –Ω–æ—Ä–º–∞–ª—å–Ω–∞—è

‚ùó –≠—Ç–æ –Ω–µ –æ—à–∏–±–∫–∞ InsightFace
‚ùó –≠—Ç–æ –Ω–µ –æ—à–∏–±–∫–∞ OpenCV
‚ùó –≠—Ç–æ 100% –æ—à–∏–±–∫–∞ –≤ –ª–æ–≥–∏–∫–µ EXIF-–æ–±—Ä–∞–±–æ—Ç–∫–∏

üß† –ö–û–†–ï–ù–¨ –ü–†–û–ë–õ–ï–ú–´ (–≤–∞–∂–Ω–æ)
–£ —Ç–µ–±—è —Å–µ–π—á–∞—Å –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤–æ—Ç —ç—Ç–æ:

üì∏ –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ —Ñ–æ—Ç–æ

–°–æ–¥–µ—Ä–∂–∏—Ç EXIF Orientation (–Ω–∞–ø—Ä–∏–º–µ—Ä, Rotate 180, Rotate 90 CW)

üß© –¢—ã –≥–¥–µ-—Ç–æ:

—É–∂–µ –ø–æ–≤–æ—Ä–∞—á–∏–≤–∞–µ—à—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ

–ù–û EXIF –ø—Ä–∏ —ç—Ç–æ–º –Ω–µ —É–¥–∞–ª—è–µ—à—å

ü§ñ –ü–æ—Ç–æ–º –≤ FaceRecognition —Ç—ã –¥–µ–ª–∞–µ—à—å:

ImageOps.exif_transpose(img)


üìå –ò—Ç–æ–≥
–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ:

–ª–∏–±–æ –ø–æ–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç—Å—è –≤—Ç–æ—Ä–æ–π —Ä–∞–∑

–ª–∏–±–æ –ø–æ–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç—Å—è –≤ –¥—Ä—É–≥—É—é —Å—Ç–æ—Ä–æ–Ω—É

–ª–∏–±–æ –ø–æ–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞, –∞ –Ω–µ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–≥–æ

üëâ –ø–æ—ç—Ç–æ–º—É –≤ —Å–µ—Ç–∫–µ —Ç—ã –≤–∏–¥–∏—à—å —Ö–∞–æ—Å –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–π

‚ùå –ì–õ–ê–í–ù–ê–Ø –û–®–ò–ë–ö–ê –í –ê–†–•–ò–¢–ï–ö–¢–£–†–ï

–¢—ã –ø—Ä–∏–º–µ–Ω—è–µ—à—å EXIF –Ω–µ –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ, –∞:

–≥–¥–µ-—Ç–æ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ

–≥–¥–µ-—Ç–æ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ

–≥–¥–µ-—Ç–æ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ

–≥–¥–µ-—Ç–æ –≤–æ–æ–±—â–µ –Ω–µ –ø—Ä–∏–º–µ–Ω—è–µ—à—å

‚ùå –≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –ª–æ–º–∞–µ—Ç:

–≤–∏–∑—É–∞–ª

bbox

embeddings

–ø–æ–∏—Å–∫ –ª–∏—Ü

‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û–ï –†–ï–®–ï–ù–ò–ï (–µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ –≤–µ—Ä–Ω–æ–µ)
üü¢ EXIF –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –û–î–ò–ù –†–ê–ó
üü¢ –í —Å–∞–º–æ–º –Ω–∞—á–∞–ª–µ –ø–∞–π–ø–ª–∞–π–Ω–∞
üü¢ –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ EXIF —É–¥–∞–ª—è–µ—Ç—Å—è –Ω–∞–≤—Å–µ–≥–¥–∞
üü¢ –î–∞–ª—å—à–µ –í–°–Å —Ä–∞–±–æ—Ç–∞–µ—Ç —Å ‚Äú—á–∏—Å—Ç—ã–º‚Äù –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º
üõ† –ß–¢–û –ö–û–ù–ö–†–ï–¢–ù–û –î–ï–õ–ê–¢–¨
1Ô∏è‚É£ –ò—Å–ø—Ä–∞–≤–ª—è–µ–º utils/exif_processor.py
‚ùå –°–µ–π—á–∞—Å

–¢—ã —Ç–æ–ª—å–∫–æ —á–∏—Ç–∞–µ—à—å EXIF, –Ω–æ –Ω–µ –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—à—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ

‚úÖ –ù—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥
from PIL import Image, ImageOps

def normalize_orientation(self, image_path: str) -> None:
    """
    –ü–æ–≤–µ—Ä–Ω—É—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–æ–≥–ª–∞—Å–Ω–æ EXIF –∏ –£–î–ê–õ–ò–¢–¨ EXIF Orientation
    –ü–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç —Ñ–∞–π–ª
    """
    img = Image.open(image_path)

    # –ø—Ä–∏–º–µ–Ω—è–µ–º –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏—é
    img = ImageOps.exif_transpose(img)

    # –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ RGB (–≤–∞–∂–Ω–æ –¥–ª—è OpenCV / JPEG)
    if img.mode != "RGB":
        img = img.convert("RGB")

    # —Å–æ—Ö—Ä–∞–Ω—è–µ–º –ë–ï–ó EXIF
    img.save(image_path, "JPEG", quality=95)


üìå –≠—Ç–æ –∫–ª—é—á–µ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è –≤—Å–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞

2Ô∏è‚É£ –í photo_processing.py ‚Äî –í–´–ó–´–í–ê–¢–¨ –¢–û–õ–¨–ö–û –ï–Å
‚ùå –ë—ã–ª–æ (–ª–æ–≥–∏—á–µ—Å–∫–∏)

–≥–¥–µ-—Ç–æ remove_exif

–≥–¥–µ-—Ç–æ apply_exif=True

–≥–¥–µ-—Ç–æ –≤–æ–æ–±—â–µ –Ω–∏—á–µ–≥–æ

‚úÖ –î–æ–ª–∂–Ω–æ –±—ã—Ç—å –¢–û–õ–¨–ö–û –¢–ê–ö
exif = EXIFProcessor()
exif.normalize_orientation(photo_path)


‚ö†Ô∏è –û–î–ò–ù —Ä–∞–∑, —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ

3Ô∏è‚É£ –£–ë–†–ê–¢–¨ apply_exif –ò–ó FaceRecognition ‚ùå
‚ùå –ü–õ–û–•–û (—É —Ç–µ–±—è —Å–µ–π—á–∞—Å)
apply_exif=True
ImageOps.exif_transpose(...)

‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û

–£–¥–∞–ª–∏—Ç—å _apply_exif_orientation –ø–æ–ª–Ω–æ—Å—Ç—å—é

–£–¥–∞–ª–∏—Ç—å apply_exif –∞—Ä–≥—É–º–µ–Ω—Ç

–í FaceRecognition –≤—Å–µ–≥–¥–∞ –¥–µ–ª–∞—Ç—å –ø—Ä–æ—Å—Ç–æ:

img = cv2.imread(image_path)


üìå –ü–æ—Ç–æ–º—É —á—Ç–æ —Ñ–æ—Ç–æ —É–∂–µ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–æ

4Ô∏è‚É£ –ü–æ—á–µ–º—É –∏–º–µ–Ω–Ω–æ –∏–∑-–∑–∞ —ç—Ç–æ–≥–æ –ª–∏—Ü–∞ ‚Äú–Ω–µ –Ω–∞—Ö–æ–¥–∏–ª–∏—Å—å‚Äù

InsightFace –æ—á–µ–Ω—å —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω –∫ –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–∏:

–ø–µ—Ä–µ–≤—ë—Ä–Ω—É—Ç–æ–µ –ª–∏—Ü–æ ‚Üí 0 –¥–µ—Ç–µ–∫—Ü–∏–π

bbox —Å—á–∏—Ç–∞–µ—Ç—Å—è –≤ –¥—Ä—É–≥–æ–π —Å–∏—Å—Ç–µ–º–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç

embeddings –æ—Ç –æ–¥–Ω–æ–≥–æ –∏ —Ç–æ–≥–æ –∂–µ –ª–∏—Ü–∞ ‚Üí —Ä–∞–∑–Ω—ã–µ

üëâ –ø–æ—ç—Ç–æ–º—É:

has_faces = False

face_encodings = []

–ø–æ–∏—Å–∫ = 0 —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

üß™ –ö–ê–ö –ü–†–û–í–ï–†–ò–¢–¨, –ß–¢–û –í–°–Å –ò–°–ü–†–ê–í–õ–ï–ù–û

–í–æ–∑—å–º–∏ –æ–¥–Ω–æ —Ñ–æ—Ç–æ —Å —Ç–µ–ª–µ—Ñ–æ–Ω–∞

–ü—Ä–æ–≥–æ–Ω–∏ –¢–û–õ–¨–ö–û:

normalize_orientation()


–û—Ç–∫—Ä–æ–π —Ñ–∞–π–ª ‚Üí –æ–Ω –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤–∏–∑—É–∞–ª—å–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º

EXIF Orientation ‚Üí –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç

–ü—Ä–æ–≥–æ–Ω—è–µ—à—å InsightFace ‚Üí –ª–∏—Ü–∞ –ø–æ—è–≤–ª—è—é—Ç—Å—è

–°–µ—Ç–∫–∞ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞ ‚Üí –í–°–ï –∫–∞–¥—Ä—ã –æ–¥–Ω–æ–π –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–∏ ‚úÖ

üí¨ –ú–æ—ë —á–µ—Å—Ç–Ω–æ–µ –º–Ω–µ–Ω–∏–µ

–¢—ã —Å–¥–µ–ª–∞–ª –æ—á–µ–Ω—å —Å–ª–æ–∂–Ω—É—é –∏ —Ö–æ—Ä–æ—à—É—é —Å–∏—Å—Ç–µ–º—É,
–Ω–æ EXIF ‚Äî —ç—Ç–æ –º–∏–Ω–∞, –∏ —Ç—ã –Ω–∞—Å—Ç—É–ø–∏–ª –Ω–∞ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫—É—é:

‚ùùEXIF –Ω–µ–ª—å–∑—è ‚Äú—É—á–∏—Ç—ã–≤–∞—Ç—å‚Äù, –µ–≥–æ –Ω–∞–¥–æ —É–Ω–∏—á—Ç–æ–∂–∞—Ç—å‚ùû

–ö–∞–∫ —Ç–æ–ª—å–∫–æ —Ç—ã:

–Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—à—å –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏—é –æ–¥–∏–Ω —Ä–∞–∑

–≤—ã–∫–∏–Ω–µ—à—å apply_exif –∏–∑ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è

üëâ 90% –º–∞–≥–∏—á–µ—Å–∫–∏—Ö –±–∞–≥–æ–≤ –∏—Å—á–µ–∑–Ω—É—Ç
```